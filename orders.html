<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø·Ù„Ø¨Ø§ØªÙŠ | Arab Eagles</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="js/layout.js"></script>

    <style>
        .orders-container { padding: 20px; padding-bottom: 100px; }
        .page-title {
            font-size: 1.8rem; font-weight: 800; color: transparent;
            background: linear-gradient(to right, #d4af37, #f1c40f);
            -webkit-background-clip: text; margin-bottom: 10px;
        }
        .page-subtitle { color: #888; font-size: 0.9rem; margin-bottom: 30px; }
        
        .orders-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;
        }

        .order-card {
            background: #1a1a1a; border-radius: 16px; position: relative;
            overflow: hidden; border: 1px solid #333;
            transition: transform 0.3s ease, border-color 0.3s ease;
        }
        /* ØªÙ…ÙŠÙŠØ² Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ© */
        .order-card.closed { border-color: #27ae60; opacity: 0.8; }
        .order-card.closed .status-badge { background: rgba(39, 174, 96, 0.2); color: #2ecc71; border-color: #2ecc71; }

        .order-card:hover { transform: translateY(-5px); border-color: var(--gold); opacity: 1; }

        .card-header {
            padding: 15px; background: linear-gradient(180deg, #222, #1a1a1a);
            border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center;
        }
        .job-id { color: var(--gold); font-weight: bold; font-family: sans-serif; }
        .job-date { color: #666; font-size: 0.8rem; }

        .card-body { padding: 20px; }
        .job-title { font-size: 1.2rem; font-weight: bold; color: #fff; margin-bottom: 15px; }

        .info-row {
            display: flex; justify-content: space-between; padding: 8px 0;
            border-bottom: 1px dashed #333; font-size: 0.9rem;
        }
        .info-row:last-child { border-bottom: none; }
        .info-label { color: #888; display: flex; align-items: center; gap: 8px; }
        .info-val { color: #e0e0e0; font-weight: 600; }
        .price-val { color: #2ecc71; font-family: sans-serif; }

        .card-footer {
            padding: 15px; text-align: center; border-top: 1px solid #333; background: #151515;
        }
        .status-badge {
            display: inline-block; padding: 6px 15px; border-radius: 20px;
            font-size: 0.85rem; font-weight: bold;
            background: rgba(212, 175, 55, 0.1); color: var(--gold); border: 1px solid var(--gold);
        }

        .loading-state, .error-state, .empty-state {
            grid-column: 1 / -1; text-align: center; padding: 50px 20px;
            background: #1a1a1a; border-radius: 15px; border: 1px dashed #333;
        }
        .state-icon { font-size: 3rem; color: #333; margin-bottom: 15px; }
    </style>
</head>
<body>

    <div class="orders-container">
        <h1 class="page-title">ğŸ“¦ Ø³Ø¬Ù„ Ø·Ù„Ø¨Ø§ØªÙŠ</h1>
        <p class="page-subtitle">ØªØ§Ø¨Ø¹ Ø­Ø§Ù„Ø© Ø·Ù„Ø¨Ø§ØªÙƒ Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙˆØ§Ù„Ø³Ø§Ø¨Ù‚Ø© Ø¨ÙƒÙ„ Ø³Ù‡ÙˆÙ„Ø©</p>

        <div id="orders-grid" class="orders-grid">
            <div class="loading-state">
                <i class="fas fa-circle-notch fa-spin state-icon" style="color:var(--gold)"></i>
                <p style="color:#888">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
            </div>
        </div>
    </div>

    <script>
        function fetchOrders() {
            const container = document.getElementById('orders-grid');

            // [Ù‡Ø§Ù… Ø¬Ø¯Ø§Ù‹]: Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ø¨Ø¹ Ø§Ù„Ø²Ù…Ù†ÙŠ Ù„Ù…Ù†Ø¹ Ø§Ù„Ù…ØªØµÙØ­ Ù…Ù† Ø­ÙØ¸ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
            fetch('api/get_orders.php?t=' + new Date().getTime())
                .then(res => {
                    if(!res.ok) throw new Error("Network response was not ok");
                    return res.json();
                })
                .then(data => {
                    if(data.status === 'success' && data.data.length > 0) {
                        let html = '';
                        data.data.forEach(order => {
                            const status = order.status_text || 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©';
                            // Ø¥Ø¶Ø§ÙØ© ÙƒÙ„Ø§Ø³ 'closed' Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ù…Ù†ØªÙ‡ÙŠØ© Ù„ØªØºÙŠÙŠØ± Ù„ÙˆÙ†Ù‡Ø§
                            const closedClass = order.is_closed ? 'closed' : '';
                            
                            html += `
                                <div class="order-card ${closedClass}">
                                    <div class="card-header">
                                        <span class="job-id">#${order.id}</span>
                                        <span class="job-date"><i class="far fa-clock"></i> ${order.date_formatted}</span>
                                    </div>
                                    <div class="card-body">
                                        <h3 class="job-title">${order.job_name}</h3>
                                        
                                        <div class="info-row">
                                            <span class="info-label"><i class="fas fa-layer-group"></i> Ø§Ù„ÙƒÙ…ÙŠØ©</span>
                                            <span class="info-val">${order.quantity}</span>
                                        </div>
                                        
                                        <div class="info-row">
                                            <span class="info-label"><i class="fas fa-money-bill-wave"></i> Ø§Ù„ØªÙƒÙ„ÙØ©</span>
                                            <span class="info-val price-val">${order.price_formatted}</span>
                                        </div>
                                    </div>
                                    <div class="card-footer">
                                        <span class="status-badge">${status}</span>
                                    </div>
                                </div>
                            `;
                        });
                        container.innerHTML = html;
                    } else {
                        container.innerHTML = `
                            <div class="empty-state">
                                <i class="fas fa-box-open state-icon"></i>
                                <p style="color:#888; font-size:1.1rem;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø³Ø§Ø¨Ù‚Ø©.</p>
                                <a href="new_order.html" style="color:var(--gold); margin-top:10px; display:inline-block;">Ø§Ø¨Ø¯Ø£ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ø§Ù„Ø¢Ù† &larr;</a>
                            </div>
                        `;
                    }
                })
                .catch(err => {
                    console.error(err);
                    container.innerHTML = `
                        <div class="error-state">
                            <i class="fas fa-wifi state-icon" style="color:#e74c3c"></i>
                            <p style="color:#e74c3c">ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„.</p>
                            <button onclick="fetchOrders()" style="margin-top:15px; background:#333; color:#fff; border:none; padding:8px 20px; border-radius:5px; cursor:pointer;">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</button>
                        </div>
                    `;
                });
        }

        document.addEventListener("DOMContentLoaded", () => {
            fetchOrders();
            // ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© ÙÙŠ Ø§Ù„Ù†Ø§ÙØ¨Ø§Ø±
            setTimeout(() => {
                document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
                const orderLink = document.querySelector('a[href="orders.html"]');
                if(orderLink) orderLink.classList.add('active');
            }, 100);
        });
    </script>

</body>
</html>